<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - D√©tection Multi-Appareils</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .stats-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
        }
        .device-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .fingerprint-display {
            background: #f3e5f5;
            border: 1px solid #e1bee7;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>üß™ Test - D√©tection Multi-Appareils</h1>
    
    <div class="warning">
        <strong>üéØ Objectif :</strong> Cette page teste le nouveau syst√®me qui devrait d√©tecter chaque appareil comme un visiteur unique, m√™me sur le m√™me r√©seau WiFi.
    </div>

    <div class="test-section">
        <h2>üì± Informations de Votre Appareil Actuel</h2>
        <p>V√©rifiez les caract√©ristiques uniques de votre appareil :</p>
        <button class="test-button" onclick="showCurrentDeviceInfo()">Afficher les infos de l'appareil</button>
        <button class="test-button" onclick="showDeviceFingerprint()">Afficher l'empreinte de l'appareil</button>
        <div id="current-device-info"></div>
    </div>

    <div class="test-section">
        <h2>üìä Statistiques Actuelles</h2>
        <p>V√©rifiez vos statistiques actuelles :</p>
        <button class="test-button" onclick="showCurrentStats()">Afficher les stats actuelles</button>
        <div id="current-stats"></div>
    </div>

    <div class="test-section">
        <h2>üß™ Test de D√©tection</h2>
        <p>Testez la d√©tection de nouveaux visiteurs :</p>
        <button class="test-button" onclick="forceNewVisitor()">Forcer la d√©tection d'un nouveau visiteur</button>
        <button class="test-button" onclick="simulateDifferentDevice()">Simuler un appareil diff√©rent</button>
        <button class="test-button" onclick="checkVisitorDetection()">V√©rifier la d√©tection</button>
        <div id="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üîç D√©tails des Visiteurs</h2>
        <p>Voir les d√©tails de tous les visiteurs d√©tect√©s :</p>
        <button class="test-button" onclick="showAllVisitors()">Afficher tous les visiteurs</button>
        <button class="test-button" onclick="showVisitorComparison()">Comparer les visiteurs</button>
        <div id="visitors-details"></div>
    </div>

    <div class="test-section">
        <h2>üìã Instructions de Test Multi-Appareils</h2>
        <p><strong>Pour tester sur 3 appareils diff√©rents :</strong></p>
        <ol>
            <li><strong>Appareil 1 :</strong> Ouvrez cette page sur votre ordinateur principal</li>
            <li><strong>Appareil 2 :</strong> Ouvrez cette page sur votre t√©l√©phone (m√™me WiFi)</li>
            <li><strong>Appareil 3 :</strong> Ouvrez cette page sur un autre ordinateur/tablette</li>
            <li><strong>V√©rifiez :</strong> Chaque appareil devrait √™tre compt√© comme un visiteur unique</li>
        </ol>
        
        <div class="warning">
            <strong>üí° Conseil :</strong> Utilisez des navigateurs diff√©rents (Chrome, Firefox, Safari) pour maximiser les diff√©rences.
        </div>
    </div>

    <div class="test-section">
        <h2>üîß D√©pannage</h2>
        <p>Si les appareils ne sont pas d√©tect√©s s√©par√©ment :</p>
        <ul>
            <li>V√©rifiez que chaque appareil a un navigateur diff√©rent</li>
            <li>Assurez-vous que les appareils ont des r√©solutions d'√©cran diff√©rentes</li>
            <li>Testez en mode navigation priv√©e sur certains appareils</li>
            <li>V√©rifiez la console pour les messages de d√©tection</li>
        </ul>
        
        <button class="test-button" onclick="debugDetection()">D√©boguer la d√©tection</button>
        <div id="debug-result"></div>
    </div>

    <script src="real-visitor-tracker.js"></script>
    <script>
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showCurrentDeviceInfo() {
            try {
                let result = `<div class="device-info">`;
                result += `<strong>üì± Caract√©ristiques de votre appareil :</strong><br><br>`;
                result += `Navigateur: ${navigator.userAgent.split(' ').pop()}<br>`;
                result += `Platform: ${navigator.platform}<br>`;
                result += `Langue: ${navigator.language}<br>`;
                result += `R√©solution: ${screen.width}x${screen.height}<br>`;
                result += `Profondeur de couleur: ${screen.colorDepth} bits<br>`;
                result += `C≈ìurs CPU: ${navigator.hardwareConcurrency || 'Inconnu'}<br>`;
                result += `M√©moire: ${navigator.deviceMemory || 'Inconnue'} GB<br>`;
                result += `Timezone: ${new Date().getTimezoneOffset()} minutes<br>`;
                result += `Cookies: ${navigator.cookieEnabled ? 'Activ√©s' : 'D√©sactiv√©s'}<br>`;
                result += `Do Not Track: ${navigator.doNotTrack || 'Non d√©fini'}<br>`;
                result += `</div>`;
                
                showResult('current-device-info', result, 'success');
            } catch (error) {
                showResult('current-device-info', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function showDeviceFingerprint() {
            try {
                if (window.realVisitorTracker) {
                    const fingerprint = window.realVisitorTracker.deviceFingerprint;
                    let result = `<div class="fingerprint-display">`;
                    result += `<strong>üîê Empreinte de l'appareil :</strong><br><br>`;
                    result += `<code>${fingerprint}</code><br><br>`;
                    result += `<small>Cette empreinte est unique √† votre appareil et est utilis√©e pour identifier les visiteurs uniques.</small>`;
                    result += `</div>`;
                    
                    showResult('current-device-info', result, 'success');
                } else {
                    showResult('current-device-info', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('current-device-info', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function showCurrentStats() {
            try {
                if (window.realVisitorTracker) {
                    const stats = window.realVisitorTracker.getStats();
                    
                    let result = `<div class="stats-display">`;
                    result += `<strong>üìä Statistiques actuelles :</strong><br><br>`;
                    result += `Total visites: ${stats.totalVisits}<br>`;
                    result += `Visiteurs uniques: ${stats.uniqueVisitors}<br>`;
                    result += `Pays diff√©rents: ${stats.countries.length}<br>`;
                    result += `Visites aujourd'hui: ${window.realVisitorTracker.getTodayVisits()}<br>`;
                    result += `Refreshes d√©tect√©s: ${window.realVisitorTracker.getRefreshCount()}<br>`;
                    result += `Derni√®re mise √† jour: ${new Date(stats.lastUpdated).toLocaleString('fr-FR')}<br>`;
                    result += `</div>`;
                    
                    showResult('current-stats', result, 'success');
                } else {
                    showResult('current-stats', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('current-stats', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function forceNewVisitor() {
            try {
                if (window.realVisitorTracker) {
                    // Forcer la d√©tection d'un nouveau visiteur
                    window.realVisitorTracker.forceNewVisitorDetection();
                    showResult('test-result', '‚úÖ Nouveau visiteur forc√© ! V√©rifiez les stats.', 'success');
                    
                    // Mettre √† jour l'affichage
                    setTimeout(() => {
                        showCurrentStats();
                    }, 1000);
                } else {
                    showResult('test-result', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('test-result', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function simulateDifferentDevice() {
            try {
                // Simuler un appareil diff√©rent en modifiant temporairement les propri√©t√©s
                const originalUserAgent = navigator.userAgent;
                const originalPlatform = navigator.platform;
                
                // Modifier temporairement (simulation)
                Object.defineProperty(navigator, 'userAgent', {
                    value: originalUserAgent + ' [SIMULATED]',
                    configurable: true
                });
                
                Object.defineProperty(navigator, 'platform', {
                    value: originalPlatform + ' [SIMULATED]',
                    configurable: true
                });
                
                showResult('test-result', 'üîÑ Appareil simul√©. Maintenant forcez une nouvelle visite !', 'info');
                
                // Restaurer apr√®s 5 secondes
                setTimeout(() => {
                    Object.defineProperty(navigator, 'userAgent', {
                        value: originalUserAgent,
                        configurable: true
                    });
                    Object.defineProperty(navigator, 'platform', {
                        value: originalPlatform,
                        configurable: true
                    });
                    showResult('test-result', '‚úÖ Appareil restaur√© √† l\'√©tat normal.', 'success');
                }, 5000);
                
            } catch (error) {
                showResult('test-result', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function checkVisitorDetection() {
            try {
                if (window.realVisitorTracker) {
                    const stats = window.realVisitorTracker.getStats();
                    const currentFingerprint = window.realVisitorTracker.deviceFingerprint;
                    
                    // V√©rifier si cet appareil est d√©j√† dans les stats
                    const existingVisitor = stats.visitors.find(v => 
                        v.deviceFingerprint === currentFingerprint
                    );
                    
                    if (existingVisitor) {
                        showResult('test-result', 
                            `‚úÖ Appareil d√©j√† d√©tect√© !<br>
                             Visiteur #${existingVisitor.id} - ${existingVisitor.device} ${existingVisitor.browser}<br>
                             Visites: ${existingVisitor.visitCount} | Derni√®re: ${new Date(existingVisitor.lastVisit).toLocaleString('fr-FR')}`, 
                            'success');
                    } else {
                        showResult('test-result', '‚ùå Appareil non encore d√©tect√©. Forcez une nouvelle visite !', 'error');
                    }
                } else {
                    showResult('test-result', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('test-result', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function showAllVisitors() {
            try {
                if (window.realVisitorTracker) {
                    const stats = window.realVisitorTracker.getStats();
                    
                    if (stats.visitors.length === 0) {
                        showResult('visitors-details', '‚ÑπÔ∏è Aucun visiteur d√©tect√© pour le moment.', 'info');
                        return;
                    }
                    
                    let result = `<div class="stats-display">`;
                    result += `<strong>üë• Tous les visiteurs d√©tect√©s (${stats.visitors.length}) :</strong><br><br>`;
                    
                    stats.visitors.forEach((visitor, index) => {
                        const date = new Date(visitor.timestamp).toLocaleString('fr-FR');
                        result += `<strong>Visiteur #${visitor.id}:</strong><br>`;
                        result += `  üì± ${visitor.device} ${visitor.browser}<br>`;
                        result += `  üåç ${visitor.city}, ${visitor.country}<br>`;
                        result += `  üìÖ ${date}<br>`;
                        result += `  üîê Empreinte: ${visitor.deviceFingerprint.substring(0, 10)}...<br>`;
                        result += `  üìä Visites: ${visitor.visitCount || 1}<br><br>`;
                    });
                    
                    result += `</div>`;
                    
                    showResult('visitors-details', result, 'success');
                } else {
                    showResult('visitors-details', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('visitors-details', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function showVisitorComparison() {
            try {
                if (window.realVisitorTracker) {
                    const stats = window.realVisitorTracker.getStats();
                    
                    if (stats.visitors.length < 2) {
                        showResult('visitors-details', '‚ÑπÔ∏è Il faut au moins 2 visiteurs pour comparer.', 'info');
                        return;
                    }
                    
                    let result = `<div class="stats-display">`;
                    result += `<strong>üîç Comparaison des visiteurs :</strong><br><br>`;
                    
                    // Comparer les 2 premiers visiteurs
                    const visitor1 = stats.visitors[0];
                    const visitor2 = stats.visitors[1];
                    
                    result += `<strong>Visiteur 1:</strong> ${visitor1.device} ${visitor1.browser}<br>`;
                    result += `<strong>Visiteur 2:</strong> ${visitor2.device} ${visitor2.browser}<br><br>`;
                    
                    result += `<strong>Diff√©rences d√©tect√©es :</strong><br>`;
                    result += `- Appareil: ${visitor1.device !== visitor2.device ? '‚úÖ Diff√©rent' : '‚ùå Identique'}<br>`;
                    result += `- Navigateur: ${visitor1.browser !== visitor2.browser ? '‚úÖ Diff√©rent' : '‚ùå Identique'}<br>`;
                    result += `- R√©solution: ${visitor1.screenResolution !== visitor2.screenResolution ? '‚úÖ Diff√©rente' : '‚ùå Identique'}<br>`;
                    result += `- Empreinte: ${visitor1.deviceFingerprint !== visitor2.deviceFingerprint ? '‚úÖ Diff√©rente' : '‚ùå Identique'}<br>`;
                    
                    result += `</div>`;
                    
                    showResult('visitors-details', result, 'success');
                } else {
                    showResult('visitors-details', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('visitors-details', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        function debugDetection() {
            try {
                if (window.realVisitorTracker) {
                    const stats = window.realVisitorTracker.getStats();
                    const currentFingerprint = window.realVisitorTracker.deviceFingerprint;
                    
                    let result = `<div class="stats-display">`;
                    result += `<strong>üîß D√©bogage de la d√©tection :</strong><br><br>`;
                    result += `Empreinte actuelle: ${currentFingerprint}<br>`;
                    result += `Visiteurs enregistr√©s: ${stats.visitors.length}<br><br>`;
                    
                    if (stats.visitors.length > 0) {
                        result += `<strong>Empreintes enregistr√©es :</strong><br>`;
                        stats.visitors.forEach((visitor, index) => {
                            result += `${index + 1}. ${visitor.deviceFingerprint} (${visitor.device} ${visitor.browser})<br>`;
                        });
                    }
                    
                    result += `</div>`;
                    
                    showResult('debug-result', result, 'success');
                } else {
                    showResult('debug-result', '‚ùå Tracker non disponible', 'error');
                }
            } catch (error) {
                showResult('debug-result', `‚ùå Erreur : ${error.message}`, 'error');
            }
        }

        // Test automatique au chargement
        window.addEventListener('load', function() {
            setTimeout(() => {
                showResult('current-stats', '‚ÑπÔ∏è Page charg√©e. Commencez par afficher les infos de votre appareil !', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
